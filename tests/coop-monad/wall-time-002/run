rm -rf build

# More or less arbitrary values
SECONDS_TO_RUN=30
VALUES_TO_CHECK1=20
VALUES_TO_CHECK2=50

# Run the test program for certain amount of time
stdbuf -oL $1 --exec main --no-color --console-width 0 --no-banner --find-ipkg WallTimeInfinite.idr > temp &
runpid=$!
sleep $SECONDS_TO_RUN
kill $runpid

# Processes may be interleaved, but the rest should be not.
# Also, we may need to erase or round printed time stamps.
grep -v 'proc 2' temp | head -n $VALUES_TO_CHECK1 | sed 's/[0-4][0-9]]/00]/' | sed 's/[5-9][0-9]]/50]/' | sed 's/ [0-9]]/ 0]/'
grep -v 'proc 1' temp | head -n $VALUES_TO_CHECK2 | sed 's/[0-4][0-9]]/00]/' | sed 's/[5-9][0-9]]/50]/' | sed 's/ [0-9]]/ 0]/'
rm -r temp

rm -rf build
